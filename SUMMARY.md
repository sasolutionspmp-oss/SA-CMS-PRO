SUMMARY SNAPSHOT — 2025-09-20T15:20Z (~330 words)

Documentation overhaul (Task 20) is committed and Tasks 19–18 now add the regression and tooling backbone for the reverse-order backlog push. On the backend side I introduced targeted pytest modules under `tests/unit/ingest/` and `tests/unit/metrics/` to lock down document parsing, classification, risk heuristics, and metrics normalisation. The parsing suite covers text/csv fallbacks, the PDF extraction hook, and snippet truncation logic; classifier tests validate the discipline, revision, and addendum detectors; risk flagger tests exercise a new `app/ingest/risk_flagger.py` utility that tags liquidated damages, bonding, no-substitution clauses, and extended warranties with line references. Metrics tests assert `normalize_metrics_payload` coerces project counts and sanitises deltas. All four test files run cleanly via `.venv\Scripts\python -m pytest tests/unit/ingest/test_parsing.py tests/unit/ingest/test_classifier.py tests/unit/ingest/test_risk_flagger.py tests/unit/metrics/test_metrics_normalizer.py`.

To support the new risk assertions I created `app/ingest/risk_flagger.py` with a dataclass-based API returning de-duplicated `RiskFlag` entries (code, message, line, snippet). The patterns currently cover our critical contract warnings and can be extended when Task 16 arrives. No other ingest code paths were touched.

On the frontend I wired Playwright into the toolchain (`@playwright/test`, `playwright.config.ts`, and scripts/test commands). The smoke scenario `tests/e2e/intake-workflow.spec.ts` presently focuses on verifying the client hits `/api/intake/launch` when an operator submits the intake form; the request is intercepted and fulfilled with stub data so the run stays hermetic. The test executes successfully with `pnpm run test` after installing the Chromium bundle through `pnpm exec playwright install chromium`. We can enrich the scenario later when the dashboard wiring (Tasks 4/5/17) is implemented.

Task 18 polishes the repo automation. `scripts/dev.ps1` now gates dependencies (pnpm) and exposes skip switches for the API, worker, and frontend alongside the earlier `-DryRun` preview, so engineers can start only what they need while still capturing logs under `output/logs/dev`. `scripts/seed.ps1` gained `-SkipSeed`, `-SkipIngest`, and `-WaitForApi` options, configurable credentials, and the same exit-code surfacing, making reseeds and ingest smoke-tests resilient. The updated GETTING_STARTED guide walks through the workflow so a single dry run + seed command bootstraps a demo stack.

Tracking artefacts are current: `TASKS.md` shows Tasks 18–20 marked off, and `PROGRESS.md` logs the pytest/Playwright runs, dev bootstrap dry run, and the initial seed attempt (with guidance for outdated databases). Next in the reverse sequence is Task 17 (frontend/backend integration), where we will swap the mock APIs in `frontend/src/api.ts` for real endpoints and drive the new tests against a live stack using these scripts.

## Task 19 - Tests (2025-09-20)

Extended the backend regression net to cover the new estimator workflows. A lightweight `xlsxwriter` stub now lives in `tests/conftest.py` so API suites can execute export routes without optional wheels. Fresh unit cases under `tests/unit/apps/api/test_estimator_service.py` seed intake runs, assert scope mining metadata, verify rate recalculation when toggling acceptance, and confirm scenario snapshots persist with their totals. Service updates align the ORM models with the `extra` JSON columns and merge scenarios before refresh to avoid session invalidation. Targeted pytest runs (`pytest tests/unit/apps/api/test_estimator_service.py`, `pytest tests/api/test_lane3_endpoints.py::test_crm_board_and_creation`) pass, giving us confidence to proceed toward Task 18. 


